######################################################
# ATTENTION-ATTENTION-ATTENTION-ATTENTION-ATTENTION
# make sure you run this FIRST
# source configure-env-hera-top-node.sh
# ATTENTION-ATTENTION-ATTENTION-ATTENTION-ATTENTION
######################################################

carbonrelay1:
  image: nuancemobility/carbon
  command: relay
  ports:
   - "2003:2003"
   - "2004:2004"
  environment:
   - HERA_CARBON_RELAY_DESTINATIONS
   - HERA_CARBON_INIT_SCRIPT_LOG_VERBOSE
  volumes:
   - ./carbon/relay:/etc/carbon
   
carbonrelay2:
  image: nuancemobility/carbon
  command: relay
  ports:
   - "2013:2003"
   - "2014:2004"
  environment:
   - HERA_CARBON_RELAY_DESTINATIONS
   - HERA_CARBON_INIT_SCRIPT_LOG_VERBOSE
  volumes:
   - ./carbon/relay:/etc/carbon
   
carbonrelay3:
  image: nuancemobility/carbon
  command: relay
  ports:
   - "2023:2003"
   - "2024:2004"
  environment:
   - HERA_CARBON_RELAY_DESTINATIONS
   - HERA_CARBON_INIT_SCRIPT_LOG_VERBOSE
  volumes:
   - ./carbon/relay:/etc/carbon
   
carbonrelay4:
  image: nuancemobility/carbon
  command: relay
  ports:
   - "2033:2003"
   - "2034:2004"
  environment:
   - HERA_CARBON_RELAY_DESTINATIONS
   - HERA_CARBON_INIT_SCRIPT_LOG_VERBOSE
  volumes:
   - ./carbon/relay:/etc/carbon
   
carbonrelay5:
  image: nuancemobility/carbon
  command: relay
  ports:
   - "2043:2003"
   - "2044:2004"
  environment:
   - HERA_CARBON_RELAY_DESTINATIONS
   - HERA_CARBON_INIT_SCRIPT_LOG_VERBOSE
  volumes:
   - ./carbon/relay:/etc/carbon
   
carbonrelay6:
  image: nuancemobility/carbon
  command: relay
  ports:
   - "2053:2003"
   - "2054:2004"
  environment:
   - HERA_CARBON_RELAY_DESTINATIONS
   - HERA_CARBON_INIT_SCRIPT_LOG_VERBOSE
  volumes:
   - ./carbon/relay:/etc/carbon
   
carbonrelay7:
  image: nuancemobility/carbon
  command: relay
  ports:
   - "2063:2003"
   - "2064:2004"
  environment:
   - HERA_CARBON_RELAY_DESTINATIONS
   - HERA_CARBON_INIT_SCRIPT_LOG_VERBOSE
  volumes:
   - ./carbon/relay:/etc/carbon
   
carbonrelay8:
  image: nuancemobility/carbon
  command: relay
  ports:
   - "2073:2003"
   - "2074:2004"
  environment:
   - HERA_CARBON_RELAY_DESTINATIONS
   - HERA_CARBON_INIT_SCRIPT_LOG_VERBOSE
  volumes:
   - ./carbon/relay:/etc/carbon

carbonrelay9:
  image: nuancemobility/carbon
  command: relay
  ports:
   - "2083:2003"
   - "2084:2004"
  environment:
   - HERA_CARBON_RELAY_DESTINATIONS
   - HERA_CARBON_INIT_SCRIPT_LOG_VERBOSE
  volumes:
   - ./carbon/relay:/etc/carbon
   
carbonrelay10:
  image: nuancemobility/carbon
  command: relay
  ports:
   - "2093:2003"
   - "2094:2004"
  environment:
   - HERA_CARBON_RELAY_DESTINATIONS
   - HERA_CARBON_INIT_SCRIPT_LOG_VERBOSE
  volumes:
   - ./carbon/relay:/etc/carbon
   
carbonrelay11:
  image: nuancemobility/carbon
  command: relay
  ports:
   - "2103:2003"
   - "2104:2004"
  environment:
   - HERA_CARBON_RELAY_DESTINATIONS
   - HERA_CARBON_INIT_SCRIPT_LOG_VERBOSE
  volumes:
   - ./carbon/relay:/etc/carbon
   
carbonrelay12:
  image: nuancemobility/carbon
  command: relay
  ports:
   - "2113:2003"
   - "2114:2004"
  environment:
   - HERA_CARBON_RELAY_DESTINATIONS
   - HERA_CARBON_INIT_SCRIPT_LOG_VERBOSE
  volumes:
   - ./carbon/relay:/etc/carbon
   
carbonrelay13:
  image: nuancemobility/carbon
  command: relay
  ports:
   - "2123:2003"
   - "2124:2004"
  environment:
   - HERA_CARBON_RELAY_DESTINATIONS
   - HERA_CARBON_INIT_SCRIPT_LOG_VERBOSE
  volumes:
   - ./carbon/relay:/etc/carbon
   
carbonrelay14:
  image: nuancemobility/carbon
  command: relay
  ports:
   - "2133:2003"
   - "2134:2004"
  environment:
   - HERA_CARBON_RELAY_DESTINATIONS
   - HERA_CARBON_INIT_SCRIPT_LOG_VERBOSE
  volumes:
   - ./carbon/relay:/etc/carbon
   
carbonrelay15:
  image: nuancemobility/carbon
  command: relay
  ports:
   - "2143:2003"
   - "2144:2004"
  environment:
   - HERA_CARBON_RELAY_DESTINATIONS
   - HERA_CARBON_INIT_SCRIPT_LOG_VERBOSE
  volumes:
   - ./carbon/relay:/etc/carbon
   
carbonrelay16:
  image: nuancemobility/carbon
  command: relay
  ports:
   - "2153:2003"
   - "2154:2004"
  environment:
   - HERA_CARBON_RELAY_DESTINATIONS
   - HERA_CARBON_INIT_SCRIPT_LOG_VERBOSE
  volumes:
   - ./carbon/relay:/etc/carbon
   
carboncache0:
  image: nuancemobility/carbon
  command: cache
  volumes:
   - ./carbon/cache:/etc/carbon
  volumes_from:
   - ncsmonitoring_whisper_1

graphite1:
  image: nuancemobility/graphite-web
  ports:
   - "80:80"
  environment:
   - HERA_GRAPHITE_WEB_CARBONLINK_HOSTS
   - HERA_GRAPHITE_WEB_CLUSTER_SERVERS
   - HERA_GRAPHITE_WEB_APACHE2_MAX_REQUEST_WORKER
   - HERA_GRAPHITE_WEB_APACHE2_SERVER_LIMIT
   - HERA_GRAPHITE_WEB_APACHE2_THREADS
   - HERA_GRAPHITE_WEB_APACHE2_PROCESSES
   - HERA_GRAPHITE_WEB_INIT_SCRIPT_LOG_VERBOSE
  volumes:
   - ./graphite-web:/etc/graphite
  volumes_from:
   - ncsmonitoring_whisper_1
  links:
   - carboncache0

elasticsearch:
  image: elasticsearch:1.6
  command: -Des.node.name="hera_elasticsearch_001" -Des.bootstrap.mlockall=true
  ports:
   - "9200:9200"
   - "9300:9300"
  environment:
   - ES_HEAP_SIZE=1024m
  volumes_from:
   - ncsmonitoring_elasticsearchdata_1

grafana:
  image: nuancemobility/grafana
  ports:
   - "8080:80"
  environment:
   - HERA_GRAFANA_LOCAL_ELASTICSEARCH_URL
   - HERA_GRAFANA_LOCAL_GRAPHITE_URL
   - HERA_GRAFANA_INIT_SCRIPT_LOG_VERBOSE
  volumes:
   - ./grafana/config.js:/usr/share/grafana/config.js
  links:
   - elasticsearch